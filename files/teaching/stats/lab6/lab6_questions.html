<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bogdan G. Popescu">

<title>Lab 6: Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="lab6_questions_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab6_questions_files/libs/quarto-html/quarto.js"></script>
<script src="lab6_questions_files/libs/quarto-html/popper.min.js"></script>
<script src="lab6_questions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab6_questions_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab6_questions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab6_questions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab6_questions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab6_questions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab6_questions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro"><span class="toc-section-number">1</span>  Intro</a></li>
  <li><a href="#z-tests" id="toc-z-tests" class="nav-link" data-scroll-target="#z-tests"><span class="toc-section-number">2</span>  Z-Tests</a>
  <ul class="collapse">
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data"><span class="toc-section-number">2.1</span>  Loading the Data</a></li>
  <li><a href="#cleaning-the-data" id="toc-cleaning-the-data" class="nav-link" data-scroll-target="#cleaning-the-data"><span class="toc-section-number">2.2</span>  Cleaning the Data</a></li>
  <li><a href="#inspecting-the-data" id="toc-inspecting-the-data" class="nav-link" data-scroll-target="#inspecting-the-data"><span class="toc-section-number">2.3</span>  Inspecting the data</a></li>
  <li><a href="#sorting-the-dataframe-in-the-order-of-life_expectancy" id="toc-sorting-the-dataframe-in-the-order-of-life_expectancy" class="nav-link" data-scroll-target="#sorting-the-dataframe-in-the-order-of-life_expectancy"><span class="toc-section-number">2.4</span>  Sorting the dataframe in the order of life_expectancy</a></li>
  <li><a href="#make-a-barplot-for-the-first-10-countries" id="toc-make-a-barplot-for-the-first-10-countries" class="nav-link" data-scroll-target="#make-a-barplot-for-the-first-10-countries"><span class="toc-section-number">2.5</span>  Make a barplot for the first 10 countries</a></li>
  </ul></li>
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem"><span class="toc-section-number">3</span>  Problem</a>
  <ul class="collapse">
  <li><a href="#comparing-means---greater-than-a-number" id="toc-comparing-means---greater-than-a-number" class="nav-link" data-scroll-target="#comparing-means---greater-than-a-number"><span class="toc-section-number">3.1</span>  Comparing means - greater than a number</a></li>
  <li><a href="#comparing-means---less-than-a-number" id="toc-comparing-means---less-than-a-number" class="nav-link" data-scroll-target="#comparing-means---less-than-a-number"><span class="toc-section-number">3.2</span>  Comparing means - less than a number</a></li>
  </ul></li>
  <li><a href="#z-scores" id="toc-z-scores" class="nav-link" data-scroll-target="#z-scores"><span class="toc-section-number">4</span>  Z-Scores</a></li>
  <li><a href="#converting-a-distribution-to-a-standard-normal-distribution" id="toc-converting-a-distribution-to-a-standard-normal-distribution" class="nav-link" data-scroll-target="#converting-a-distribution-to-a-standard-normal-distribution"><span class="toc-section-number">5</span>  Converting a distribution to a standard normal distribution</a>
  <ul class="collapse">
  <li><a href="#step-calculating-the-mean" id="toc-step-calculating-the-mean" class="nav-link" data-scroll-target="#step-calculating-the-mean"><span class="toc-section-number">5.1</span>  Step: Calculating the mean</a></li>
  <li><a href="#step-calculating-the-variance" id="toc-step-calculating-the-variance" class="nav-link" data-scroll-target="#step-calculating-the-variance"><span class="toc-section-number">5.2</span>  Step: Calculating the variance</a></li>
  <li><a href="#step-applying-the-formula" id="toc-step-applying-the-formula" class="nav-link" data-scroll-target="#step-applying-the-formula"><span class="toc-section-number">5.3</span>  Step: Applying the formula</a></li>
  </ul></li>
  <li><a href="#plotting-the-new-distribution" id="toc-plotting-the-new-distribution" class="nav-link" data-scroll-target="#plotting-the-new-distribution"><span class="toc-section-number">6</span>  Plotting the new distribution</a></li>
  <li><a href="#from-normal-distributions-to-standard-normal-distributions" id="toc-from-normal-distributions-to-standard-normal-distributions" class="nav-link" data-scroll-target="#from-normal-distributions-to-standard-normal-distributions"><span class="toc-section-number">7</span>  From Normal Distributions to Standard Normal Distributions</a></li>
  <li><a href="#problem-1" id="toc-problem-1" class="nav-link" data-scroll-target="#problem-1"><span class="toc-section-number">8</span>  Problem</a></li>
  <li><a href="#problem-2" id="toc-problem-2" class="nav-link" data-scroll-target="#problem-2"><span class="toc-section-number">9</span>  Problem</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 6: Statistics</h1>
<p class="subtitle lead">Z-Tests, Z-Scores, and the Standard Normal Distribution</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bogdan G. Popescu </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Removing previous datasets in memory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Loading the relevant libraries</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BSDA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Intro</h1>
<p>In this lab, we learn about Z-tests, standardization, and z-scores.</p>
</section>
<section id="z-tests" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Z-Tests</h1>
<p>We learned from the lecture that Z-tests evaluate if the averages of two datasets are different from each other when standard deviation or variance is known. The sample size typically should be larger than 30. To illustrate how Z-tests work, let us go back to the sample of Latin American countries and compare them to the world.</p>
<section id="loading-the-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="loading-the-data"><span class="header-section-number">2.1</span> Loading the Data</h2>
<p>Let us go back to the old Life Expectancy dataset. If you don’t have it anymore, you can download them from the following links:</p>
<ul>
<li><a href="https://www.dropbox.com/s/k8pwn5x0mechewy/life-expectancy.csv?dl=0" target="_blank">Life expectancy data</a></li>
</ul>
<p>Let us re-examine the distribution of our life expectancy dataset by making a histogram. We need to first load the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting path</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/bgpopescu/Dropbox/john_cabot/teaching/stats/lab6/"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Loading the data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>life_expectancy <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">'./life-expectancy.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-the-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="cleaning-the-data"><span class="header-section-number">2.2</span> Cleaning the Data</h2>
<p>In the next few line we average life expectancy over country (the oiriginal dataset is a panel - with countries and years). This means that we are getting rid of the time component.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Calculating the mean</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>life_expectancy2<span class="ot">&lt;-</span>life_expectancy<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Code, Entity)<span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">life_expectancy=</span><span class="fu">mean</span>(Life.expectancy.at.birth..historical.))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Step2: Cleaning the Data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>weird_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"OWID_KOS"</span>, <span class="st">"OWID_WRL"</span>, <span class="st">""</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>clean_countries<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy2, <span class="sc">!</span>(Code <span class="sc">%in%</span> weird_labels))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Step3: Calculating the mean and SD in the dataset</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mean_empirical<span class="ot">&lt;-</span><span class="fu">mean</span>(clean_countries<span class="sc">$</span>life_expectancy, <span class="at">na.rm =</span> T)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>mean_empirical_val<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">round</span>(mean_empirical, <span class="dv">0</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sd_empirical<span class="ot">&lt;-</span><span class="fu">sd</span>(clean_countries<span class="sc">$</span>life_expectancy, <span class="at">na.rm =</span> T)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>sd_empirical_val<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">round</span>(<span class="fu">sd</span>(clean_countries<span class="sc">$</span>life_expectancy, <span class="at">na.rm =</span> T), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspecting-the-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="inspecting-the-data"><span class="header-section-number">2.3</span> Inspecting the data</h2>
<p>Let us inspect the first 10 entries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean_countries, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   Code [10]
   Code  Entity               life_expectancy
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;
 1 ABW   Aruba                           70.3
 2 AFG   Afghanistan                     45.4
 3 AGO   Angola                          45.1
 4 AIA   Anguilla                        69.4
 5 ALB   Albania                         68.3
 6 AND   Andorra                         77.0
 7 ARE   United Arab Emirates            66.1
 8 ARG   Argentina                       65.4
 9 ARM   Armenia                         67.2
10 ASM   American Samoa                  68.6</code></pre>
</div>
</div>
</section>
<section id="sorting-the-dataframe-in-the-order-of-life_expectancy" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sorting-the-dataframe-in-the-order-of-life_expectancy"><span class="header-section-number">2.4</span> Sorting the dataframe in the order of life_expectancy</h2>
<p>Let us now order our dataset based on life expectancy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>clean_countries_sorted<span class="ot">&lt;-</span>clean_countries[<span class="fu">order</span>(<span class="sc">-</span>clean_countries<span class="sc">$</span>life_expectancy),]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean_countries_sorted, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   Code [10]
   Code  Entity      life_expectancy
   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
 1 MCO   Monaco                 77.3
 2 AND   Andorra                77.0
 3 SMR   San Marino             76.9
 4 GGY   Guernsey               76.7
 5 ISR   Israel                 75.5
 6 VAT   Vatican                75.3
 7 HKG   Hong Kong              75.3
 8 JEY   Jersey                 75.2
 9 NZL   New Zealand            75.1
10 GIB   Gibraltar              75.0</code></pre>
</div>
</div>
</section>
<section id="make-a-barplot-for-the-first-10-countries" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="make-a-barplot-for-the-first-10-countries"><span class="header-section-number">2.5</span> Make a barplot for the first 10 countries</h2>
<p>Let us now make a barplot where life expectancy is ordered from highest to lowest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(clean_countries, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Okay, this looks pretty bad. Let’s focus on the first 10 countries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="ot">&lt;-</span><span class="fu">head</span>(clean_countries[<span class="fu">order</span>(clean_countries<span class="sc">$</span>life_expectancy, <span class="fu">rev</span>(clean_countries<span class="sc">$</span>life_expectancy), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>life_exp_top10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   Code [10]
   Code  Entity      life_expectancy
   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
 1 MCO   Monaco                 77.3
 2 AND   Andorra                77.0
 3 SMR   San Marino             76.9
 4 GGY   Guernsey               76.7
 5 ISR   Israel                 75.5
 6 VAT   Vatican                75.3
 7 HKG   Hong Kong              75.3
 8 JEY   Jersey                 75.2
 9 NZL   New Zealand            75.1
10 GIB   Gibraltar              75.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This looks a bit better. Let’s improve how this graph looks by adding labels for x and y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us also start the x-axis at 60 to get the differences to be more visible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">60</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">90</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10 rows containing missing values (`geom_bar()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>scale_y_continuous</code> cuts the bars. The fix is to use <code>coord_cartesian</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is better. We can be even more precise by adding age on top of the bars. To do that, we first need to add this variable in our dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="sc">$</span>life_expectancy[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 77.04861</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(life_exp_top10<span class="sc">$</span>life_expectancy[<span class="dv">2</span>], <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 77.049</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="sc">$</span>life_expectancy_chr<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"Age: "</span>, <span class="fu">as.character</span>(<span class="fu">round</span>(life_exp_top10<span class="sc">$</span>life_expectancy, <span class="dv">2</span>)))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_exp_top10, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   Code [10]
   Code  Entity      life_expectancy life_expectancy_chr
   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;              
 1 MCO   Monaco                 77.3 Age:  77.25        
 2 AND   Andorra                77.0 Age:  77.05        
 3 SMR   San Marino             76.9 Age:  76.88        
 4 GGY   Guernsey               76.7 Age:  76.72        
 5 ISR   Israel                 75.5 Age:  75.5         
 6 VAT   Vatican                75.3 Age:  75.33        
 7 HKG   Hong Kong              75.3 Age:  75.33        
 8 JEY   Jersey                 75.2 Age:  75.2         
 9 NZL   New Zealand            75.1 Age:  75.13        
10 GIB   Gibraltar              75.0 Age:  75.04        </code></pre>
</div>
</div>
<p>This looks good. Let us add this information on top of the bars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> life_expectancy_chr, <span class="at">y =</span> life_expectancy, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now mark the countries that are physically in Europe with blue. These countries are: Monaco, Andorra, San Marino, Guernsey, Vatican, Jersey, and Gibraltar. We first create a list with all these countries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>list_european_ctry<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Monaco"</span>, <span class="st">"Andorra"</span>, <span class="st">"San Marino"</span>, <span class="st">"Guernsey"</span>, <span class="st">"Vatican"</span>, <span class="st">"Jersey"</span>, <span class="st">"Gibraltar"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>list_european_ctry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Monaco"     "Andorra"    "San Marino" "Guernsey"   "Vatican"   
[6] "Jersey"     "Gibraltar" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="sc">$</span>european<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="sc">$</span>european<span class="ot">&lt;-</span><span class="st">"No"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>life_exp_top10<span class="sc">$</span>european[life_exp_top10<span class="sc">$</span>Entity <span class="sc">%in%</span> list_european_ctry]<span class="ot">&lt;-</span><span class="st">"Yes"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_exp_top10, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
# Groups:   Code [10]
   Code  Entity      life_expectancy life_expectancy_chr european
   &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;   
 1 MCO   Monaco                 77.3 Age:  77.25         Yes     
 2 AND   Andorra                77.0 Age:  77.05         Yes     
 3 SMR   San Marino             76.9 Age:  76.88         Yes     
 4 GGY   Guernsey               76.7 Age:  76.72         Yes     
 5 ISR   Israel                 75.5 Age:  75.5          No      
 6 VAT   Vatican                75.3 Age:  75.33         Yes     
 7 HKG   Hong Kong              75.3 Age:  75.33         No      
 8 JEY   Jersey                 75.2 Age:  75.2          Yes     
 9 NZL   New Zealand            75.1 Age:  75.13         No      
10 GIB   Gibraltar              75.0 Age:  75.04         Yes     </code></pre>
</div>
</div>
<p>Let us now mark the European countries in blue and the rest grey.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy, <span class="at">fill=</span>european)) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> life_expectancy_chr, <span class="at">y =</span> life_expectancy, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey40"</span>, <span class="st">"blue"</span>))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now it seems that we should probably have a different name for the legend. Maybe “European” would be good. We can do that with option name in <code>scale_fill_manual</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy, <span class="at">fill=</span>european)) <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> life_expectancy_chr, <span class="at">y =</span> life_expectancy, </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"European"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey40"</span>, <span class="st">"blue"</span>))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We should also probably fix the overlapping x ticks. The way we do that is by playing with the theme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>figure_1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy, <span class="at">fill=</span>european)) <span class="sc">+</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> life_expectancy_chr, <span class="at">y =</span> life_expectancy, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"European"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey40"</span>, <span class="st">"blue"</span>))<span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>figure_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now should do the same thing for Latin America.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step3: Selecting the Latin American countries</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>latam_countries<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Belize"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Costa Rica"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"El Salvador"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Guatemala"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Honduras"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Mexico"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Nicaragua"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Panama"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Argentina"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Bolivia"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Brazil"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Chile"</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Colombia"</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Ecuador"</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Guyana"</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Paraguay"</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Peru"</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Suriname"</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Uruguay"</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Venezuela"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Cuba"</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Dominican Republic"</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Haiti"</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>latam_countries_df<span class="ot">&lt;-</span><span class="fu">subset</span>(clean_countries, (Entity <span class="sc">%in%</span> latam_countries))</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(latam_countries_df, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   Code [10]
   Code  Entity             life_expectancy
   &lt;chr&gt; &lt;chr&gt;                        &lt;dbl&gt;
 1 ARG   Argentina                     65.4
 2 BLZ   Belize                        66.0
 3 BOL   Bolivia                       52.6
 4 BRA   Brazil                        61.1
 5 CHL   Chile                         63.3
 6 COL   Colombia                      63.1
 7 CRI   Costa Rica                    68.7
 8 CUB   Cuba                          67.2
 9 DOM   Dominican Republic            61.1
10 ECU   Ecuador                       65.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10_latam<span class="ot">&lt;-</span><span class="fu">head</span>(latam_countries_df[<span class="fu">order</span>(latam_countries_df<span class="sc">$</span>life_expectancy, <span class="fu">rev</span>(latam_countries_df<span class="sc">$</span>life_expectancy), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ], <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_exp_top10_latam, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
# Groups:   Code [10]
   Code  Entity     life_expectancy
   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;
 1 URY   Uruguay               70.8
 2 CRI   Costa Rica            68.7
 3 PAN   Panama                68.4
 4 CUB   Cuba                  67.2
 5 BLZ   Belize                66.0
 6 ARG   Argentina             65.4
 7 ECU   Ecuador               65.0
 8 VEN   Venezuela             64.8
 9 PRY   Paraguay              63.7
10 CHL   Chile                 63.3</code></pre>
</div>
</div>
<p>We should create labels first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>life_exp_top10_latam<span class="sc">$</span>life_expectancy_chr<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Age: "</span>, <span class="fu">as.character</span>(<span class="fu">round</span>(life_exp_top10_latam<span class="sc">$</span>life_expectancy, <span class="dv">2</span>)))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_exp_top10_latam, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   Code [10]
   Code  Entity     life_expectancy life_expectancy_chr
   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;              
 1 URY   Uruguay               70.8 Age: 70.76         
 2 CRI   Costa Rica            68.7 Age: 68.69         
 3 PAN   Panama                68.4 Age: 68.41         
 4 CUB   Cuba                  67.2 Age: 67.25         
 5 BLZ   Belize                66.0 Age: 65.97         
 6 ARG   Argentina             65.4 Age: 65.41         
 7 ECU   Ecuador               65.0 Age: 64.96         
 8 VEN   Venezuela             64.8 Age: 64.85         
 9 PRY   Paraguay              63.7 Age: 63.75         
10 CHL   Chile                 63.3 Age: 63.3          </code></pre>
</div>
</div>
<p>Let us create a barplot for the top 10 countries in Latin America:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>figure_2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10_latam, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10_latam,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> life_expectancy_chr, <span class="at">y =</span> life_expectancy, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>figure_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now recreate the two graphs and add them together using grid.arrange.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(figure_1, figure_2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A few things could help: - remove the blue-grey coloring - remove the Y-axis label from the second graph - Add descriptive titles - Marking the age in white inside the bar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>figure_3<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Life Expectancy"</span>)<span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(life_expectancy,<span class="dv">2</span>), <span class="at">y =</span> life_expectancy, </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="dv">2</span>), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Top 10 countries in the World"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>figure_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>figure_4<span class="ot">&lt;-</span><span class="fu">ggplot</span>(life_exp_top10_latam, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Entity, <span class="sc">-</span>life_expectancy), <span class="at">y =</span> life_expectancy)) <span class="sc">+</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="at">data=</span>life_exp_top10_latam,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(life_expectancy,<span class="dv">2</span>), <span class="at">y =</span> life_expectancy, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="dv">2</span>), <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Top 10 countries in Latin America"</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>figure_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now put them side by side</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(figure_3, figure_4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This looks much better.</p>
</section>
</section>
<section id="problem" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Problem</h1>
<p>Now we can finally ask the question: Is the mean life expectancy in Latin America equal to the population life expectancy? What kind of test do we perform?</p>
<p><strong>Answer</strong>: Two-tailed z-test. This is because we are asking if something is “EQUAL” to something else.</p>
<p>What do we need to perform a z-test?</p>
<p>We need the following:</p>
<ul>
<li>Population Mean <span class="math inline">\(\mu\)</span><br>
</li>
<li>Population SD <span class="math inline">\(\sigma\)</span><br>
</li>
<li>Sample Mean for Latam: <span class="math inline">\(\bar{X}\)</span><br>
</li>
<li>Sample size for Latam: n<br>
</li>
</ul>
<p>Population Mean <span class="math inline">\(\mu\)</span> is: 61.934159<br>
Population SD <span class="math inline">\(\sigma\)</span> is: 8.68723<br>
Sample Mean for Latam <span class="math inline">\(\bar{X}\)</span> is 61.9140352<br>
Sample size for Latam n is 23<br>
</p>
<p>How do we know this?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mean_population<span class="ot">&lt;-</span><span class="fu">mean</span>(clean_countries<span class="sc">$</span>life_expectancy)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sd_population<span class="ot">&lt;-</span><span class="fu">sd</span>(clean_countries<span class="sc">$</span>life_expectancy)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>mean_latam<span class="ot">&lt;-</span><span class="fu">mean</span>(latam_countries_df<span class="sc">$</span>life_expectancy)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>sample_size_latam<span class="ot">&lt;-</span><span class="fu">nrow</span>(latam_countries_df)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>mean_population</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61.93416</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>sd_population</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.68723</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mean_latam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61.91404</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sample_size_latam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23</code></pre>
</div>
</div>
<p>We can finally perform a z-test following the formula:</p>
<p><span class="math display">\[Z_{obs}=\frac{\bar{X}-\mu}{\frac{\sigma}{\sqrt{n}}}\]</span> We now simply calculate the <span class="math inline">\(Z_obs\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>z_obs<span class="ot">&lt;-</span>(mean_latam<span class="sc">-</span>mean_population)<span class="sc">/</span>(sd_population<span class="sc">/</span><span class="fu">sqrt</span>(sample_size_latam))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>z_obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01110945</code></pre>
</div>
</div>
<p>The same score can be obtained if we do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>z_obs2<span class="ot">&lt;-</span>BSDA<span class="sc">::</span><span class="fu">z.test</span>(latam_countries_df<span class="sc">$</span>life_expectancy, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mu=</span>mean_population, <span class="at">sigma.x=</span>sd_population,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>z_obs2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-sample z-Test

data:  latam_countries_df$life_expectancy
z = -0.011109, p-value = 0.9911
alternative hypothesis: true mean is not equal to 61.93416
95 percent confidence interval:
 58.36373 65.46434
sample estimates:
mean of x 
 61.91404 </code></pre>
</div>
</div>
<p>Note that we define whether this is one-tailed or a two-tailed z-test by using the option <code>two.sided</code> in <code>alternative</code>.</p>
<p>What is the Null Hypothesis for a one-tailed z-test?<br>
</p>
<p>The Null Hypothesis - <span class="math inline">\(H_0\)</span>: The sample mean (for Latam) is equal to the population mean.<br>
</p>
<p>What is the Alternative Hypothesis for one-tailed z-test - <span class="math inline">\(H_1\)</span>?<br>
</p>
<p>The Alternative Hypothesis - <span class="math inline">\(H_1\)</span>: The sample mean (for Latam) is NOT equal to the population mean.<br>
Note that this is also specified in the test itself: “alternative hypothesis: true mean is not equal to 61.93416”</p>
<p>Do we accept or reject the <span class="math inline">\(H_0\)</span>?</p>
<p>We don’t reject the <span class="math inline">\(H_0\)</span> because the p-value of 0.9911 is larger than 0.05. The sample mean (for Latam) is equal to the population mean.</p>
<p>This is easier to see by doing a boxplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>clean_countries_countinent<span class="ot">&lt;-</span>clean_countries</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>clean_countries_countinent<span class="sc">$</span>sample<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>clean_countries_countinent<span class="sc">$</span>sample<span class="ot">&lt;-</span><span class="st">"Rest"</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>clean_countries_countinent<span class="sc">$</span>sample[clean_countries_countinent<span class="sc">$</span>Entity <span class="sc">%in%</span> latam_countries]<span class="ot">&lt;-</span><span class="st">"Latam"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(clean_countries_countinent, <span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> life_expectancy, <span class="at">color =</span> sample)) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="comparing-means---greater-than-a-number" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="comparing-means---greater-than-a-number"><span class="header-section-number">3.1</span> Comparing means - greater than a number</h2>
<p>Now we can finally ask the question: Is the mean life expectancy in Latin America greater to the population life expectancy? What kind of test do we perform?</p>
<p><strong>Answer</strong>: One-tailed z-test. This is because we are asking if something is “GREATER” than something else.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BSDA)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>z_obs_greater<span class="ot">&lt;-</span>BSDA<span class="sc">::</span><span class="fu">z.test</span>(latam_countries_df<span class="sc">$</span>life_expectancy, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mu=</span>mean_population, <span class="at">sigma.x=</span>sd_population,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>z_obs_greater</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-sample z-Test

data:  latam_countries_df$life_expectancy
z = -0.011109, p-value = 0.5044
alternative hypothesis: true mean is greater than 61.93416
95 percent confidence interval:
 58.93453       NA
sample estimates:
mean of x 
 61.91404 </code></pre>
</div>
</div>
<p>What is the Null Hypothesis for a one-tailed z-test?<br>
</p>
<p>The Null Hypothesis - <span class="math inline">\(H_0\)</span>: The sample mean (for Latam) is not greater than the population mean.<br>
</p>
<p>What is the Alternative Hypothesis for a one-tailed z-test - <span class="math inline">\(H_1\)</span>?<br>
</p>
<p>The Alternative Hypothesis - <span class="math inline">\(H_1\)</span>: The sample mean (for Latam) is greater than the population mean.<br>
</p>
<p>Do we accept or reject the <span class="math inline">\(H_0\)</span>?</p>
<p>We don’t reject the <span class="math inline">\(H_0\)</span> because the p-value of 0.5044 is larger than 0.05. The sample mean (for Latam) is not greater than the population mean.</p>
</section>
<section id="comparing-means---less-than-a-number" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="comparing-means---less-than-a-number"><span class="header-section-number">3.2</span> Comparing means - less than a number</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>z_obs_less<span class="ot">&lt;-</span>BSDA<span class="sc">::</span><span class="fu">z.test</span>(latam_countries_df<span class="sc">$</span>life_expectancy, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mu=</span>mean_population, <span class="at">sigma.x=</span>sd_population,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alternative =</span> <span class="st">"less"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>z_obs_less</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-sample z-Test

data:  latam_countries_df$life_expectancy
z = -0.011109, p-value = 0.4956
alternative hypothesis: true mean is less than 61.93416
95 percent confidence interval:
       NA 64.89354
sample estimates:
mean of x 
 61.91404 </code></pre>
</div>
</div>
<p>What is the Null Hypothesis for a one-tailed z-test?<br>
</p>
<p>The Null Hypothesis - <span class="math inline">\(H_0\)</span>: The sample mean (for Latam) is NOT less than the population mean.<br>
</p>
<p>What is the Alternative Hypothesis for a one-tailed z-test - <span class="math inline">\(H_1\)</span>?<br>
</p>
<p>The Alternative Hypothesis - <span class="math inline">\(H_1\)</span>: The sample mean (for Latam) is less than the population mean.<br>
</p>
<p>Do we accept or reject the <span class="math inline">\(H_0\)</span>?</p>
<p>We don’t reject the <span class="math inline">\(H_0\)</span> because the p-value of 0.4956 is larger than 0.05. This means that the sample mean for Latam is not less than the population mean.</p>
</section>
</section>
<section id="z-scores" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Z-Scores</h1>
<p>As we discussed previously, the <em>standard normal distribution</em> is a special type of distribution with a mean <span class="math inline">\(\mu = 0\)</span> and a standard deviation <span class="math inline">\(\sigma = 1\)</span>. For example, a z-score of 2 tells us that we are 2 standard deviations to the right of the mean.</p>
<p>A z-score allows to calculate how much area that specific score is associated with using the z-score table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>generated_data_10000obs<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>generated_data_10000obs<span class="ot">&lt;-</span><span class="fu">data.frame</span>(generated_data_10000obs)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(generated_data_10000obs)<span class="ot">&lt;-</span><span class="st">"value"</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>lines<span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Mean (\u03BC)"</span>, <span class="st">": 0"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">"SD(\u03C3)"</span>, <span class="st">": 1"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>figure_5<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> generated_data_10000obs, <span class="fu">aes</span>(<span class="at">x=</span>value))<span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">50</span>, <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>))<span class="sc">+</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="sc">-</span><span class="dv">3</span>, </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="dv">600</span>, </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span>lines,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>           <span class="co">#parse=T,</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"red"</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>figure_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_bar()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Each number on the X-axis (i.e.&nbsp;-4…4) corresponds to a z-score. A z-score tells us how many standard deviations an observation is from the mean <span class="math inline">\(\mu\)</span>. A z-score also allows to calculate the area associated with that z-score is, based on a z-score table (standard normal table).</p>
<p>The cool thing about a standard normal distribution is that any normal distribution can be turned into a standard normal distribution with a mean <span class="math inline">\(\mu\)</span> of 0 and a standard distrubution <span class="math inline">\(\sigma\)</span> of 1. This process is called <strong>standardization</strong>.</p>
<p>The standardization formula:</p>
<p><span class="math display">\[
z=\frac{x - \mu}{\sigma}
\]</span> where: z - z-score x - observation <span class="math inline">\(\mu\)</span> - population mean <span class="math inline">\(\sigma\)</span> - population variance</p>
</section>
<section id="converting-a-distribution-to-a-standard-normal-distribution" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Converting a distribution to a standard normal distribution</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Loading the data</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>life_expectancy <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">'./life-expectancy.csv'</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(life_expectancy)[<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="st">"life_expectancy_values"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>figure_5<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">50</span>, <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>figure_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us examine the first entries in our dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values
1  Afghanistan  AFG 1950                   27.7
2  Afghanistan  AFG 1951                   28.0
3  Afghanistan  AFG 1952                   28.4
4  Afghanistan  AFG 1953                   28.9
5  Afghanistan  AFG 1954                   29.2
6  Afghanistan  AFG 1955                   29.9
7  Afghanistan  AFG 1956                   30.4
8  Afghanistan  AFG 1957                   30.9
9  Afghanistan  AFG 1958                   31.5
10 Afghanistan  AFG 1959                   32.0</code></pre>
</div>
</div>
<p>Let us now apply standardization to our dataset.</p>
<section id="step-calculating-the-mean" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="step-calculating-the-mean"><span class="header-section-number">5.1</span> Step: Calculating the mean</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mean_life_exp<span class="ot">&lt;-</span><span class="fu">mean</span>(life_expectancy<span class="sc">$</span>life_expectancy_values, <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The mean for life expectancy throughout the world for the entire time series between 1543 and 2021 is 61.78. How come we have years that are lower than 1800? Let’s examine what the countries for which we have such long historical data are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>historical_df_life_exp<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy, Year<span class="sc">&lt;</span><span class="dv">1800</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(historical_df_life_exp<span class="sc">$</span>Entity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Denmark"        "Europe"         "Finland"        "Sweden"        
[5] "United Kingdom"</code></pre>
</div>
</div>
<p>Thus, we can clearly see that our dataset contains detailed historical data on life expectancy for: Denmark, Europe, Finland, Sweden, United Kingdom. This is even more visible if we plot the time series for these countries prior to 1800s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>figure_6<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> historical_df_life_exp, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> life_expectancy_values))<span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Entity))<span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>figure_6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So the graph shows us that we have the longest data for the UK.</p>
</section>
<section id="step-calculating-the-variance" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="step-calculating-the-variance"><span class="header-section-number">5.2</span> Step: Calculating the variance</h2>
<p>The next step entails calculating the variance of our dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>var_life_exp<span class="ot">&lt;-</span><span class="fu">var</span>(life_expectancy<span class="sc">$</span>life_expectancy_values, <span class="at">na.rm=</span>T)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>var_life_exp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 167.3311</code></pre>
</div>
</div>
<p>Life expectancy has a variance of 167.3311413, and the standard deviation is 12.94.</p>
</section>
<section id="step-applying-the-formula" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="step-applying-the-formula"><span class="header-section-number">5.3</span> Step: Applying the formula</h2>
<p>We can now apply the formula:</p>
<p><span class="math display">\[
z=\frac{x - \mu}{\sigma}
\]</span></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Formula</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Result 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Result 2</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values
1  Afghanistan  AFG 1950                   27.7
2  Afghanistan  AFG 1951                   28.0
3  Afghanistan  AFG 1952                   28.4
4  Afghanistan  AFG 1953                   28.9
5  Afghanistan  AFG 1954                   29.2
6  Afghanistan  AFG 1955                   29.9
7  Afghanistan  AFG 1956                   30.4
8  Afghanistan  AFG 1957                   30.9
9  Afghanistan  AFG 1958                   31.5
10 Afghanistan  AFG 1959                   32.0
                               z_score
1  (life_expectancy - mean) / variance
2  (life_expectancy - mean) / variance
3  (life_expectancy - mean) / variance
4  (life_expectancy - mean) / variance
5  (life_expectancy - mean) / variance
6  (life_expectancy - mean) / variance
7  (life_expectancy - mean) / variance
8  (life_expectancy - mean) / variance
9  (life_expectancy - mean) / variance
10 (life_expectancy - mean) / variance</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values              z_score
1  Afghanistan  AFG 1950                   27.7 (27.7 - 61.78) / 167
2  Afghanistan  AFG 1951                   28.0   (28 - 61.78) / 167
3  Afghanistan  AFG 1952                   28.4 (28.4 - 61.78) / 167
4  Afghanistan  AFG 1953                   28.9 (28.9 - 61.78) / 167
5  Afghanistan  AFG 1954                   29.2 (29.2 - 61.78) / 167
6  Afghanistan  AFG 1955                   29.9 (29.9 - 61.78) / 167
7  Afghanistan  AFG 1956                   30.4 (30.4 - 61.78) / 167
8  Afghanistan  AFG 1957                   30.9 (30.9 - 61.78) / 167
9  Afghanistan  AFG 1958                   31.5 (31.5 - 61.78) / 167
10 Afghanistan  AFG 1959                   32.0   (32 - 61.78) / 167</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values    z_score
1  Afghanistan  AFG 1950                   27.7 -0.2036959
2  Afghanistan  AFG 1951                   28.0 -0.2019030
3  Afghanistan  AFG 1952                   28.4 -0.1995126
4  Afghanistan  AFG 1953                   28.9 -0.1965245
5  Afghanistan  AFG 1954                   29.2 -0.1947316
6  Afghanistan  AFG 1955                   29.9 -0.1905483
7  Afghanistan  AFG 1956                   30.4 -0.1875602
8  Afghanistan  AFG 1957                   30.9 -0.1845721
9  Afghanistan  AFG 1958                   31.5 -0.1809864
10 Afghanistan  AFG 1959                   32.0 -0.1779983</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Let’s do exactly that and inspect the first 10 entries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>life_expectancy<span class="sc">$</span>z_score<span class="ot">&lt;-</span>(life_expectancy<span class="sc">$</span>life_expectancy_values<span class="sc">-</span> mean_life_exp) <span class="sc">/</span> var_life_exp</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values    z_score
1  Afghanistan  AFG 1950                   27.7 -0.2036959
2  Afghanistan  AFG 1951                   28.0 -0.2019030
3  Afghanistan  AFG 1952                   28.4 -0.1995126
4  Afghanistan  AFG 1953                   28.9 -0.1965245
5  Afghanistan  AFG 1954                   29.2 -0.1947316
6  Afghanistan  AFG 1955                   29.9 -0.1905483
7  Afghanistan  AFG 1956                   30.4 -0.1875602
8  Afghanistan  AFG 1957                   30.9 -0.1845721
9  Afghanistan  AFG 1958                   31.5 -0.1809864
10 Afghanistan  AFG 1959                   32.0 -0.1779983</code></pre>
</div>
</div>
</section>
</section>
<section id="plotting-the-new-distribution" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Plotting the new distribution</h1>
<p>We can now plot the new distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>lines<span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Mean (\u03BC)"</span>, <span class="st">": "</span>, <span class="fu">round</span>(mean_life_exp, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">"SD(\u03C3)"</span>, <span class="st">": "</span>, <span class="fu">round</span>(<span class="fu">sd</span>(life_expectancy<span class="sc">$</span>life_expectancy_values, <span class="at">na.rm=</span>T), <span class="dv">2</span>))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>figure_7<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy, <span class="fu">aes</span>(<span class="at">x=</span>z_score))<span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">50</span>, <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="at">by =</span> <span class="fl">0.1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>),</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"text"</span>, </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="sc">-</span><span class="fl">0.2</span>, </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="dv">1000</span>, </span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span>lines,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>           <span class="co">#parse=T,</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"red"</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>figure_7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_bar()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I used <code>scales::comma</code> option within <code>scale_x_continuous</code> to avoid scientific notation.</p>
<p>Let us now plot the two histograms side by side</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(figure_5, figure_7, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values (`geom_bar()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that the distributions are very similar. The logic is that if I plug in an x values of 50, that will give a z-score of -0.0704272. Similarly, if I plug an x value of 80, that will give a z-score of 0.108858.</p>
</section>
<section id="from-normal-distributions-to-standard-normal-distributions" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> From Normal Distributions to Standard Normal Distributions</h1>
<p>To further understand how the normal distribution turns into a standard normal distribution, let us work with 10 bins, which we create manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Cutting our data in 10 with manually defined values</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>cutpoints</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0 10 20 30 40 50 60 70 80 90</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step2: Creating Bin Indicators in our dataframe</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>life_expectancy<span class="sc">$</span>bin_indicator <span class="ot">&lt;-</span> <span class="fu">cut</span>(life_expectancy<span class="sc">$</span>life_expectancy_values,cutpoints,<span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Entity Code Year life_expectancy_values    z_score bin_indicator
1  Afghanistan  AFG 1950                   27.7 -0.2036959       (20,30]
2  Afghanistan  AFG 1951                   28.0 -0.2019030       (20,30]
3  Afghanistan  AFG 1952                   28.4 -0.1995126       (20,30]
4  Afghanistan  AFG 1953                   28.9 -0.1965245       (20,30]
5  Afghanistan  AFG 1954                   29.2 -0.1947316       (20,30]
6  Afghanistan  AFG 1955                   29.9 -0.1905483       (20,30]
7  Afghanistan  AFG 1956                   30.4 -0.1875602       (30,40]
8  Afghanistan  AFG 1957                   30.9 -0.1845721       (30,40]
9  Afghanistan  AFG 1958                   31.5 -0.1809864       (30,40]
10 Afghanistan  AFG 1959                   32.0 -0.1779983       (30,40]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step3: Calculate how many observations are included in each bin</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>life_expectancy2<span class="ot">&lt;-</span>life_expectancy <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bin_indicator) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">observations =</span> <span class="fu">n</span>())</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy2, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
# Groups:   bin_indicator [2]
   Entity      Code   Year life_expectancy_values z_score bin_indicator observ…¹
   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;                  &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;            &lt;int&gt;
 1 Afghanistan AFG    1950                   27.7  -0.204 (20,30]            181
 2 Afghanistan AFG    1951                   28    -0.202 (20,30]            181
 3 Afghanistan AFG    1952                   28.4  -0.200 (20,30]            181
 4 Afghanistan AFG    1953                   28.9  -0.197 (20,30]            181
 5 Afghanistan AFG    1954                   29.2  -0.195 (20,30]            181
 6 Afghanistan AFG    1955                   29.9  -0.191 (20,30]            181
 7 Afghanistan AFG    1956                   30.4  -0.188 (30,40]           1217
 8 Afghanistan AFG    1957                   30.9  -0.185 (30,40]           1217
 9 Afghanistan AFG    1958                   31.5  -0.181 (30,40]           1217
10 Afghanistan AFG    1959                   32    -0.178 (30,40]           1217
# … with abbreviated variable name ¹​observations</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step4: Making the histogram</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>figure_8<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>figure_8  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It might make sense to include the cutoff points for the purpose of clarity. But before we do that, we need to create individual labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy2, <span class="sc">!</span><span class="fu">duplicated</span>(life_expectancy2<span class="sc">$</span>bin_indicator))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(labels, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   bin_indicator [8]
  Entity      Code   Year life_expectancy_values  z_score bin_indicator observ…¹
  &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;                  &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;            &lt;int&gt;
1 Afghanistan AFG    1950                   27.7 -0.204   (20,30]            181
2 Afghanistan AFG    1956                   30.4 -0.188   (30,40]           1217
3 Afghanistan AFG    1975                   40.1 -0.130   (40,50]           2893
4 Afghanistan AFG    1993                   51.5 -0.0615  (50,60]           3703
5 Afghanistan AFG    2009                   60.4 -0.00828 (60,70]           5702
6 Albania     ALB    1980                   70.5  0.0521  (70,80]           5983
7 Andorra     AND    1992                   80.3  0.111   (80,90]            752
8 Cambodia    KHM    1975                   12   -0.298   (10,20]             14
# … with abbreviated variable name ¹​observations</code></pre>
</div>
</div>
<p>It probably now makes sense to get rid of the variables which we no longer need: Entity, Code, Year, life_expectancy_values and z_score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(labels, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Entity, Code, Year, life_expectancy_values, z_score))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(labels, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
# Groups:   bin_indicator [8]
  bin_indicator observations
  &lt;fct&gt;                &lt;int&gt;
1 (20,30]                181
2 (30,40]               1217
3 (40,50]               2893
4 (50,60]               3703
5 (60,70]               5702
6 (70,80]               5983
7 (80,90]                752
8 (10,20]                 14</code></pre>
</div>
</div>
<p>Every text that we add to ggplot will need a set of coordinates or an x (horizontal) and y (vertical). These are the two numbers which tell R where the text should be placed. If we look at our labels dataframe, we can see that observations can be used as the y-coordinate.</p>
<p>Let us create a new variable called <code>y_coordinate</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>y_coord<span class="ot">&lt;-</span>labels<span class="sc">$</span>observations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the other other variable, we can probably use the first value of the bin indicator as an x-coordinate. The only issue is that the bin indicator variable is a string variable. Therefore, we need to find a way to extract the first number from the bin indicator. For example, we need to find to extract “20” from “(20, 30]” or “30” from “(30,40]”.</p>
<p>The way to do this is by using the stringi library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us examine if this does what we expect it to do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>string_to_extract<span class="ot">&lt;-</span><span class="st">"(20, 30]"</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stri_extract_first_regex</span>(string_to_extract, <span class="st">"</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "20"</code></pre>
</div>
</div>
<p>Let’s try another example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>string_to_extract<span class="ot">&lt;-</span><span class="st">"(30, 40]"</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stri_extract_first_regex</span>(string_to_extract, <span class="st">"</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "30"</code></pre>
</div>
</div>
<p>Does this work with lists?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>string_to_extract<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"(20, 30]"</span>, <span class="st">"(30, 40]"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stri_extract_first_regex</span>(string_to_extract, <span class="st">"</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "20" "30"</code></pre>
</div>
</div>
<p>Yes. The <code>stri_extract_first_regex</code> seems to work for list. Therefore, it is a good contender to user for our label dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">stri_extract_first_regex</span>(labels<span class="sc">$</span>bin_indicator, <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?'</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(labels<span class="sc">$</span>x_coord)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   bin_indicator [8]
  bin_indicator observations y_coord x_coord
  &lt;fct&gt;                &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;
1 (20,30]                181     181      20
2 (30,40]               1217    1217      30
3 (40,50]               2893    2893      40
4 (50,60]               3703    3703      50
5 (60,70]               5702    5702      60
6 (70,80]               5983    5983      70
7 (80,90]                752     752      80
8 (10,20]                 14      14      10</code></pre>
</div>
</div>
<p>We are now in a good position to place our annotation: bin_indicator</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>figure_9<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>figure_9  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now also include the number of observations in each bin.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>figure_10<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>figure_10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ooops. This does not look great. The bin inidcator overlaps with the number of observations. We should therefore maybe change the coordinate for the number of observations so that they appear underneath the bin indicator variable. The way to do this is by using the <code>vjust</code> option. If we say <code>vjust = 2</code>, this means that it adds 2 to the vertical coordinate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>figure_11<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>figure_11</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To make it even more clear that the second number is the number of observations, it probably makes sense to indicate that the second number is the number of observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>observations_chr<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Obs: "</span>, <span class="fu">as.character</span>(labels<span class="sc">$</span>observations), <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us now inspect the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(labels, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
# Groups:   bin_indicator [8]
  bin_indicator observations y_coord x_coord observations_chr
  &lt;fct&gt;                &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;           
1 (20,30]                181     181      20 Obs: 181        
2 (30,40]               1217    1217      30 Obs: 1217       
3 (40,50]               2893    2893      40 Obs: 2893       
4 (50,60]               3703    3703      50 Obs: 3703       
5 (60,70]               5702    5702      60 Obs: 5702       
6 (70,80]               5983    5983      70 Obs: 5983       
7 (80,90]                752     752      80 Obs: 752        
8 (10,20]                 14      14      10 Obs: 14         </code></pre>
</div>
</div>
<p>Let us now replot the results using the newly created variable <code>observations_chr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>figure_12<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>figure_12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It might be a good idea to make the number of observations smaller.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>figure_13<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>figure_13</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To illustrate how our values turn into z-score, it probably makes sense to transform our data and work with a smaller dataset.</p>
<p>We can therefore calculate mean ages by bin indicator and then calculate the corresponding z-score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>life_expectancy3<span class="ot">&lt;-</span>life_expectancy2 <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bin_indicator) <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_age_bin =</span> <span class="fu">mean</span>(life_expectancy_values))</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy3, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
# Groups:   bin_indicator [2]
   Entity      Code   Year life_expectancy_val…¹ z_score bin_i…² obser…³ mean_…⁴
   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;                 &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;
 1 Afghanistan AFG    1950                  27.7  -0.204 (20,30]     181    27.1
 2 Afghanistan AFG    1951                  28    -0.202 (20,30]     181    27.1
 3 Afghanistan AFG    1952                  28.4  -0.200 (20,30]     181    27.1
 4 Afghanistan AFG    1953                  28.9  -0.197 (20,30]     181    27.1
 5 Afghanistan AFG    1954                  29.2  -0.195 (20,30]     181    27.1
 6 Afghanistan AFG    1955                  29.9  -0.191 (20,30]     181    27.1
 7 Afghanistan AFG    1956                  30.4  -0.188 (30,40]    1217    36.4
 8 Afghanistan AFG    1957                  30.9  -0.185 (30,40]    1217    36.4
 9 Afghanistan AFG    1958                  31.5  -0.181 (30,40]    1217    36.4
10 Afghanistan AFG    1959                  32    -0.178 (30,40]    1217    36.4
# … with abbreviated variable names ¹​life_expectancy_values, ²​bin_indicator,
#   ³​observations, ⁴​mean_age_bin</code></pre>
</div>
</div>
<p>Let us now also calculate the z-scores for each bin, assuming that each bin is an individual observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>life_expectancy4<span class="ot">&lt;-</span>life_expectancy3 <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bin_indicator) <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_bin_zscore =</span> (mean_age_bin<span class="sc">-</span>mean_life_exp)<span class="sc">/</span>var_life_exp)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy4, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
# Groups:   bin_indicator [2]
   Entity      Code   Year life_expect…¹ z_score bin_i…² obser…³ mean_…⁴ age_b…⁵
   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Afghanistan AFG    1950          27.7  -0.204 (20,30]     181    27.1  -0.207
 2 Afghanistan AFG    1951          28    -0.202 (20,30]     181    27.1  -0.207
 3 Afghanistan AFG    1952          28.4  -0.200 (20,30]     181    27.1  -0.207
 4 Afghanistan AFG    1953          28.9  -0.197 (20,30]     181    27.1  -0.207
 5 Afghanistan AFG    1954          29.2  -0.195 (20,30]     181    27.1  -0.207
 6 Afghanistan AFG    1955          29.9  -0.191 (20,30]     181    27.1  -0.207
 7 Afghanistan AFG    1956          30.4  -0.188 (30,40]    1217    36.4  -0.151
 8 Afghanistan AFG    1957          30.9  -0.185 (30,40]    1217    36.4  -0.151
 9 Afghanistan AFG    1958          31.5  -0.181 (30,40]    1217    36.4  -0.151
10 Afghanistan AFG    1959          32    -0.178 (30,40]    1217    36.4  -0.151
# … with abbreviated variable names ¹​life_expectancy_values, ²​bin_indicator,
#   ³​observations, ⁴​mean_age_bin, ⁵​age_bin_zscore</code></pre>
</div>
</div>
<p>The procesure of getting z-scores is also called “standardization”. We may want to add these new measures to our histogram. To do that, we need to redo our labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Removing duplicates</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy4, <span class="sc">!</span><span class="fu">duplicated</span>(life_expectancy2<span class="sc">$</span>bin_indicator))</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Step2: Removing irrelevant variables</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(labels, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Entity, Code, Year, life_expectancy_values, z_score))</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Step3: Creating the y-coordinate</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>y_coord<span class="ot">&lt;-</span>labels<span class="sc">$</span>observations</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Step4: Extracting the left edge of the bin</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">stri_extract_first_regex</span>(labels<span class="sc">$</span>bin_indicator, <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?'</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(labels<span class="sc">$</span>x_coord)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Step5: Creating Obs. + value</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>observations_chr<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Obs: "</span>, <span class="fu">as.character</span>(labels<span class="sc">$</span>observations), <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Step6: Inspecting the result</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(labels, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   bin_indicator [8]
  bin_indicator observations mean_age_bin age_bin_zscore y_coord x_coord obser…¹
  &lt;fct&gt;                &lt;int&gt;        &lt;dbl&gt;          &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
1 (20,30]                181         27.1        -0.207      181      20 Obs: 1…
2 (30,40]               1217         36.4        -0.151     1217      30 Obs: 1…
3 (40,50]               2893         45.2        -0.0990    2893      40 Obs: 2…
4 (50,60]               3703         55.3        -0.0385    3703      50 Obs: 3…
5 (60,70]               5702         65.4         0.0217    5702      60 Obs: 5…
6 (70,80]               5983         74.1         0.0737    5983      70 Obs: 5…
7 (80,90]                752         81.8         0.120      752      80 Obs: 7…
8 (10,20]                 14         16.5        -0.271       14      10 Obs: 14
# … with abbreviated variable name ¹​observations_chr</code></pre>
</div>
</div>
<p>We need to create equally intuitive labels for the bin mean and z-score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step7: Rounding bin mean age to two decimals</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>mean_age_bin<span class="ot">&lt;-</span><span class="fu">round</span>(labels<span class="sc">$</span>mean_age_bin, <span class="dv">2</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Step8: Rounding bin z-score to two decimals</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>age_bin_zscore<span class="ot">&lt;-</span><span class="fu">round</span>(labels<span class="sc">$</span>age_bin_zscore, <span class="dv">2</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Step8: Creating mean age character</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>mean_age_bin_chr<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Mean Bin: "</span>, <span class="fu">as.character</span>(labels<span class="sc">$</span>mean_age_bin), <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Step9: Creating bin z-score character</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>age_bin_zscore_chr<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Z-Score Bin: "</span>, <span class="fu">as.character</span>(labels<span class="sc">$</span>age_bin_zscore), <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(labels, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
# Groups:   bin_indicator [8]
  bin_indicator observ…¹ mean_…² age_b…³ y_coord x_coord obser…⁴ mean_…⁵ age_b…⁶
  &lt;fct&gt;            &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 (20,30]            181    27.1   -0.21     181      20 Obs: 1… Mean B… Z-Scor…
2 (30,40]           1217    36.4   -0.15    1217      30 Obs: 1… Mean B… Z-Scor…
3 (40,50]           2893    45.2   -0.1     2893      40 Obs: 2… Mean B… Z-Scor…
4 (50,60]           3703    55.4   -0.04    3703      50 Obs: 3… Mean B… Z-Scor…
5 (60,70]           5702    65.4    0.02    5702      60 Obs: 5… Mean B… Z-Scor…
6 (70,80]           5983    74.1    0.07    5983      70 Obs: 5… Mean B… Z-Scor…
7 (80,90]            752    81.8    0.12     752      80 Obs: 7… Mean B… Z-Scor…
8 (10,20]             14    16.5   -0.27      14      10 Obs: 14 Mean B… Z-Scor…
# … with abbreviated variable names ¹​observations, ²​mean_age_bin,
#   ³​age_bin_zscore, ⁴​observations_chr, ⁵​mean_age_bin_chr, ⁶​age_bin_zscore_chr</code></pre>
</div>
</div>
<p>We can now plot them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>figure_14<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord), <span class="at">colour =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> mean_age_bin_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">2.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> age_bin_zscore_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>figure_14</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is kind of ugly. We can maybe improve the appearance by placing the text further up and increasing the distance between labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>figure_15<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> mean_age_bin_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> age_bin_zscore_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">4.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>figure_15</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Similarly, it might make sense to increase the size of the y axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>figure_16<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> mean_age_bin_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> age_bin_zscore_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">4.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>, <span class="at">by =</span> <span class="dv">500</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>))</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>figure_16</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As a final tweak, we may want to decrease the font a bit more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>figure_17<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> bin_indicator, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> observations_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> mean_age_bin_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> age_bin_zscore_chr, <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">4.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>, <span class="at">by =</span> <span class="dv">500</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>))</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>figure_17</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us now plot the z values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>life_expectancy2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,445 × 7
# Groups:   bin_indicator [8]
   Entity      Code   Year life_expectancy_values z_score bin_indicator observ…¹
   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;                  &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;            &lt;int&gt;
 1 Afghanistan AFG    1950                   27.7  -0.204 (20,30]            181
 2 Afghanistan AFG    1951                   28    -0.202 (20,30]            181
 3 Afghanistan AFG    1952                   28.4  -0.200 (20,30]            181
 4 Afghanistan AFG    1953                   28.9  -0.197 (20,30]            181
 5 Afghanistan AFG    1954                   29.2  -0.195 (20,30]            181
 6 Afghanistan AFG    1955                   29.9  -0.191 (20,30]            181
 7 Afghanistan AFG    1956                   30.4  -0.188 (30,40]           1217
 8 Afghanistan AFG    1957                   30.9  -0.185 (30,40]           1217
 9 Afghanistan AFG    1958                   31.5  -0.181 (30,40]           1217
10 Afghanistan AFG    1959                   32    -0.178 (30,40]           1217
# … with 20,435 more rows, and abbreviated variable name ¹​observations</code></pre>
</div>
</div>
<p>We can do it directly without specifying the cutpoints.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>figure_18<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>z_score))<span class="sc">+</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>figure_18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, to make it match the data exactly, we need to use define our z cutoff points, exactly based on the age cutoff points, which we defined earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Cutting our data in 10 with manually defined values</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>cutpoints</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0 10 20 30 40 50 60 70 80 90</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step2: Creating Bin Indicators in our dataframe</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>life_expectancy2<span class="sc">$</span>bin_indicator <span class="ot">&lt;-</span> <span class="fu">cut</span>(life_expectancy2<span class="sc">$</span>life_expectancy_values,cutpoints,<span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy2, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
# Groups:   bin_indicator [2]
   Entity      Code   Year life_expectancy_values z_score bin_indicator observ…¹
   &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;                  &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;            &lt;int&gt;
 1 Afghanistan AFG    1950                   27.7  -0.204 (20,30]            181
 2 Afghanistan AFG    1951                   28    -0.202 (20,30]            181
 3 Afghanistan AFG    1952                   28.4  -0.200 (20,30]            181
 4 Afghanistan AFG    1953                   28.9  -0.197 (20,30]            181
 5 Afghanistan AFG    1954                   29.2  -0.195 (20,30]            181
 6 Afghanistan AFG    1955                   29.9  -0.191 (20,30]            181
 7 Afghanistan AFG    1956                   30.4  -0.188 (30,40]           1217
 8 Afghanistan AFG    1957                   30.9  -0.185 (30,40]           1217
 9 Afghanistan AFG    1958                   31.5  -0.181 (30,40]           1217
10 Afghanistan AFG    1959                   32    -0.178 (30,40]           1217
# … with abbreviated variable name ¹​observations</code></pre>
</div>
</div>
<p>Then we can create cutoff points for the z-scores that correspond exactly to the age cutoff points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>life_expectancy5<span class="ot">&lt;-</span>life_expectancy2<span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bin_indicator)<span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_z_score_bin =</span> <span class="fu">min</span>(z_score),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">max_z_score_bin =</span> <span class="fu">max</span>(z_score))</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(life_expectancy5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
# Groups:   bin_indicator [1]
  Entity      Code   Year life_expecta…¹ z_score bin_i…² obser…³ min_z…⁴ max_z…⁵
  &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Afghanistan AFG    1950           27.7  -0.204 (20,30]     181  -0.249  -0.190
2 Afghanistan AFG    1951           28    -0.202 (20,30]     181  -0.249  -0.190
3 Afghanistan AFG    1952           28.4  -0.200 (20,30]     181  -0.249  -0.190
4 Afghanistan AFG    1953           28.9  -0.197 (20,30]     181  -0.249  -0.190
5 Afghanistan AFG    1954           29.2  -0.195 (20,30]     181  -0.249  -0.190
6 Afghanistan AFG    1955           29.9  -0.191 (20,30]     181  -0.249  -0.190
# … with abbreviated variable names ¹​life_expectancy_values, ²​bin_indicator,
#   ³​observations, ⁴​min_z_score_bin, ⁵​max_z_score_bin</code></pre>
</div>
</div>
<p>We can now create z-score bin indicators. First, we need to round the numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>life_expectancy6<span class="ot">&lt;-</span>life_expectancy5<span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_z_score_bin=</span><span class="fu">round</span>(min_z_score_bin, <span class="dv">2</span>),</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">max_z_score_bin=</span><span class="fu">round</span>(max_z_score_bin, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second, we can create character z bin indicators:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>life_expectancy7<span class="ot">&lt;-</span>life_expectancy6<span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_score_bin=</span><span class="fu">paste0</span>(<span class="st">"("</span>, min_z_score_bin, <span class="st">" - "</span>, <span class="st">"("</span>, max_z_score_bin, <span class="st">")"</span>, <span class="st">"]"</span>))</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>life_expectancy7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,445 × 10
# Groups:   bin_indicator [8]
   Entity    Code   Year life_…¹ z_score bin_i…² obser…³ min_z…⁴ max_z…⁵ z_sco…⁶
   &lt;chr&gt;     &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1 Afghanis… AFG    1950    27.7  -0.204 (20,30]     181   -0.25   -0.19 (-0.25…
 2 Afghanis… AFG    1951    28    -0.202 (20,30]     181   -0.25   -0.19 (-0.25…
 3 Afghanis… AFG    1952    28.4  -0.200 (20,30]     181   -0.25   -0.19 (-0.25…
 4 Afghanis… AFG    1953    28.9  -0.197 (20,30]     181   -0.25   -0.19 (-0.25…
 5 Afghanis… AFG    1954    29.2  -0.195 (20,30]     181   -0.25   -0.19 (-0.25…
 6 Afghanis… AFG    1955    29.9  -0.191 (20,30]     181   -0.25   -0.19 (-0.25…
 7 Afghanis… AFG    1956    30.4  -0.188 (30,40]    1217   -0.19   -0.13 (-0.19…
 8 Afghanis… AFG    1957    30.9  -0.185 (30,40]    1217   -0.19   -0.13 (-0.19…
 9 Afghanis… AFG    1958    31.5  -0.181 (30,40]    1217   -0.19   -0.13 (-0.19…
10 Afghanis… AFG    1959    32    -0.178 (30,40]    1217   -0.19   -0.13 (-0.19…
# … with 20,435 more rows, and abbreviated variable names
#   ¹​life_expectancy_values, ²​bin_indicator, ³​observations, ⁴​min_z_score_bin,
#   ⁵​max_z_score_bin, ⁶​z_score_bin</code></pre>
</div>
</div>
<p>We can now also create a list of cutoff points based on the min and max z-score that we calculated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>list_min<span class="ot">&lt;-</span><span class="fu">unique</span>(life_expectancy7<span class="sc">$</span>min_z_score_bin)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>list_max<span class="ot">&lt;-</span><span class="fu">unique</span>(life_expectancy7<span class="sc">$</span>max_z_score_bin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can merge the two lists.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>minmax_list<span class="ot">&lt;-</span><span class="fu">c</span>(list_min, list_max)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>minmax_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.25 -0.19 -0.13 -0.07 -0.01  0.05  0.11 -0.30 -0.19 -0.13 -0.07 -0.01
[13]  0.05  0.11  0.15 -0.25</code></pre>
</div>
</div>
<p>Let us now remove the duplicates in the list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>minmax_list<span class="ot">&lt;-</span>minmax_list[<span class="sc">!</span><span class="fu">duplicated</span>(minmax_list)]</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>minmax_list<span class="ot">&lt;-</span><span class="fu">sort</span>(minmax_list, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>minmax_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.30 -0.25 -0.19 -0.13 -0.07 -0.01  0.05  0.11  0.15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>figure_19<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy2, <span class="fu">aes</span>(<span class="at">x=</span>z_score))<span class="sc">+</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks =</span> minmax_list,</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>figure_19</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Does this look the same?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(figure_17, figure_19, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us add two annotations in the two graphs which clearly show the bin edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Step1: Removing duplicates</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy7, <span class="sc">!</span><span class="fu">duplicated</span>(life_expectancy7<span class="sc">$</span>bin_indicator))</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Step2: Removing irrelevant variables</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">subset</span>(labels, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Entity, Code, Year, life_expectancy_values, z_score))</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Step3: Creating the y-coordinate</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>y_coord<span class="ot">&lt;-</span>labels<span class="sc">$</span>observations</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Step4: Extracting the left edge of the bin</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">stri_extract_first_regex</span>(labels<span class="sc">$</span>bin_indicator, <span class="st">'</span><span class="sc">\\</span><span class="st">d+([.]</span><span class="sc">\\</span><span class="st">d+)?'</span>)</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>labels<span class="sc">$</span>x_coord<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(labels<span class="sc">$</span>x_coord)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   bin_indicator [8]
  bin_indicator observations min_z_score_bin max_z_sco…¹ z_sco…² y_coord x_coord
  &lt;fct&gt;                &lt;int&gt;           &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;
1 (20,30]                181           -0.25       -0.19 (-0.25…     181      20
2 (30,40]               1217           -0.19       -0.13 (-0.19…    1217      30
3 (40,50]               2893           -0.13       -0.07 (-0.13…    2893      40
4 (50,60]               3703           -0.07       -0.01 (-0.07…    3703      50
5 (60,70]               5702           -0.01        0.05 (-0.01…    5702      60
6 (70,80]               5983            0.05        0.11 (0.05 …    5983      70
7 (80,90]                752            0.11        0.15 (0.11 …     752      80
8 (10,20]                 14           -0.3        -0.25 (-0.3 …      14      10
# … with abbreviated variable names ¹​max_z_score_bin, ²​z_score_bin</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>figure_20<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy7, <span class="fu">aes</span>(<span class="at">x=</span>life_expectancy_values))<span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>cutpoints,</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Age Bin:</span><span class="sc">\n</span><span class="st">"</span>, bin_indicator), <span class="at">y =</span> y_coord, <span class="at">x=</span> x_coord,</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>, <span class="at">by =</span> <span class="dv">500</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>))</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>figure_20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>figure_21<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data =</span> life_expectancy7, <span class="fu">aes</span>(<span class="at">x=</span>z_score))<span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>, <span class="at">breaks=</span>minmax_list,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">col=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data=</span>labels,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Z-Score Bin:</span><span class="sc">\n</span><span class="st">"</span>, z_score_bin), <span class="at">y =</span> y_coord, <span class="at">x=</span> min_z_score_bin,</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>, <span class="at">by =</span> <span class="dv">500</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">6500</span>))</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>figure_21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us finally plot them together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(figure_20, figure_21, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Thus, every bar in our age bin corresponds to a z-score bin. For example, our (20,30] age bin, corresponds to our (-0.25-(-0.19)] z-score bin.</p>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For example, our (30,40] age bin, corresponds to our (-0.19-(-0.13)] z-score bin.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="lab6_questions_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And so on and so forth.</p>
<p>Thus the original mean for the entire dataset, which we calculated to be 61.78 will be converted to 0, and the standard deviation 12.94 will be converted to 1, which are the two main characteristic of a standard normal distribution. This will happen to every distribution irrespective of the original mean and standard deviation.</p>
</section>
<section id="problem-1" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Problem</h1>
<p>Let us say that we were interested in the following problem: What is the proportion of country where the life expectancy is lower than 50?</p>
<p><span class="math inline">\(P(X&lt;50) = ?\)</span></p>
<p>We first calculate the z-score. Remember a z-score is a number representing how many standard deviations above or below the mean population the score derived from a z-test is. Essentially, it is a numerical measurement that describes a value’s relationship to the mean of a group of values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span>(<span class="dv">50</span><span class="sc">-</span>mean_life_exp)<span class="sc">/</span><span class="fu">sd</span>(life_expectancy2<span class="sc">$</span>life_expectancy_values, <span class="at">na.rm=</span>T)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.911022</code></pre>
</div>
</div>
<p>Note that is the empirical probability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>ctry_50<span class="ot">&lt;-</span><span class="fu">subset</span>(life_expectancy2, life_expectancy_values<span class="sc">&lt;</span><span class="dv">50</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(ctry_50)<span class="sc">/</span><span class="fu">nrow</span>(life_expectancy2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2092443</code></pre>
</div>
</div>
<p>Thus we need to look for the proportion of z less than -0.91.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>xval<span class="ot">&lt;-</span><span class="fu">pnorm</span>(<span class="at">q=</span>z, <span class="at">lower.tail=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>xval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1811419</code></pre>
</div>
</div>
<p>Note that this is based on a theoretical probability.</p>
<p>Thus, the proportion countries where life expectancy is lower than 50 is 0.18.</p>
</section>
<section id="problem-2" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Problem</h1>
<p>You scored 72 in your last assignment. The class mean was 60 and standard deviation was 10. The grades follow a normal distribution. What is the probability that a randomly selected person in the class had a grade lower than yours?</p>
<p>The way we do that is the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span>(<span class="dv">72-60</span>)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>xval<span class="ot">&lt;-</span><span class="fu">pnorm</span>(<span class="at">q=</span>z, <span class="at">lower.tail=</span><span class="cn">TRUE</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>xval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8849303</code></pre>
</div>
</div>
<p>What is the probability that a randomly selected person in the class had a grade higher than yours?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>xval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1150697</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="lab6_questions_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>